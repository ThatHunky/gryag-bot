# –î–æ–∫–µ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ –¢—Ä–æ—Ç—Ç–ª—ñ–Ω–≥ –°–∏—Å—Ç–µ–º–∞ - –ü–æ–≤–Ω–∏–π –ó–≤—ñ—Ç

## üê≥ –î–æ–∫–µ—Ä–∏–∑–∞—Ü—ñ—è –∑ –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º

### –°—Ç–≤–æ—Ä–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:

#### 1. Dockerfile
- **Multi-stage build**: –û–∫—Ä–µ–º—ñ –µ—Ç–∞–ø–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ —Ç–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
- **–ë–µ–∑–ø–µ–∫–∞**: –û–∫—Ä–µ–º–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á `gryagbot` –±–µ–∑ root-–ø—Ä–∞–≤
- **Auto-update –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è cron –¥–ª—è –Ω—ñ—á–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
- **Health checks**: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

#### 2. Docker Compose
- **docker-compose.yml**: –ü—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑ —Ä–µ—Å—É—Ä—Å–Ω–∏–º–∏ –ª—ñ–º—ñ—Ç–∞–º–∏
- **docker-compose.dev.yml**: –†–æ–∑—Ä–æ–±–∫–∞ –∑ volume mounting —Ç–∞ hot reload
- **Env –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**: –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ .env —Ñ–∞–π–ª—ñ–≤
- **Network isolation**: –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∞ –º–µ—Ä–µ–∂–∞ –¥–ª—è –±–µ–∑–ø–µ–∫–∏

#### 3. Auto-Update System
- **scripts/auto-update.sh**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ GitHub —â–æ–Ω–æ—á—ñ –æ 3:00
- **Backup —Å–∏—Å—Ç–µ–º–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- **Graceful restart**: –ú'—è–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö
- **Error handling**: –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

#### 4. Health Monitoring
- **scripts/healthcheck.js**: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ç–∞ –ë–î
- **Docker health checks**: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Docker –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
- **Log analysis**: –ê–Ω–∞–ª—ñ–∑ –ª–æ–≥—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

#### 5. Deployment Scripts
- **deploy.sh**: Linux/macOS –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
- **deploy.ps1**: Windows PowerShell —Å–∫—Ä–∏–ø—Ç
- **Cross-platform**: –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º

### Docker –ö–æ–º–∞–Ω–¥–∏:

```bash
# –ü—Ä–æ–¥–∞–∫—à–µ–Ω
docker-compose up -d

# –†–æ–∑—Ä–æ–±–∫–∞
docker-compose -f docker-compose.dev.yml up

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è
docker-compose pull && docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f gryag-bot
```

## üö¶ –†–æ–∑—à–∏—Ä–µ–Ω–∞ –¢—Ä–æ—Ç—Ç–ª—ñ–Ω–≥ –°–∏—Å—Ç–µ–º–∞

### –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:

#### 1. –ü–æ—à—É–∫–æ–≤—ñ –ó–∞–ø–∏—Ç–∏ (3/–≥–æ–¥–∏–Ω—É)
- **–õ—ñ–º—ñ—Ç**: 3 –ø–æ—à—É–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç–∏ –Ω–∞ –≥–æ–¥–∏–Ω—É –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- **–¢—Ä–∏–≥–µ—Ä–∏**: `/search`, `/news`, `/factcheck`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫
- **–ü–æ–≤–µ–¥—ñ–Ω–∫–∞**: –¢–∏—Ö–µ —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—ñ –ª—ñ–º—ñ—Ç—É
- **–ê–¥–º—ñ–Ω–∏**: –ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø

#### 2. –ó–≥–∞–¥–∫–∏ –ì—Ä—è–≥–∞ (3/—Ö–≤–∏–ª–∏–Ω—É)
- **–õ—ñ–º—ñ—Ç**: 3 –∑–≥–∞–¥–∫–∏ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- **–¢—Ä–∏–≥–µ—Ä–∏**: @username, "–≥—Ä—è–≥", "gryag" –≤ –≥—Ä—É–ø–æ–≤–∏—Ö —á–∞—Ç–∞—Ö
- **–ü–æ–≤–µ–¥—ñ–Ω–∫–∞**: –¢–∏—Ö–µ —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –±–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **–ê–¥–º—ñ–Ω–∏**: –ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø

#### 3. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ Handlers

**commands.js**:
```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥—É –ø–µ—Ä–µ–¥ –ø–æ—à—É–∫–æ–º
if (!botStateService.isAdmin(userId)) {
  const searchCheck = throttleService.canMakeSearchQuery(userId);
  if (!searchCheck.allowed) {
    console.log(`üîç Search throttled for user ${userId}: reached limit`);
    return; // –¢–∏—Ö–æ —ñ–≥–Ω–æ—Ä—É—î–º–æ
  }
}
```

**messages.js**:
```javascript
// –¢—Ä–æ—Ç—Ç–ª—ñ–Ω–≥ –∑–≥–∞–¥–æ–∫ –≤ –≥—Ä—É–ø–∞—Ö
if (!botStateService.isAdmin(userId) && isMentioned) {
  const mentionCheck = throttleService.canMentionGryag(userId);
  if (!mentionCheck.allowed) {
    console.log(`ü§ñ Mention throttled for user ${userId}: reached limit`);
    return; // –¢–∏—Ö–æ —ñ–≥–Ω–æ—Ä—É—î–º–æ
  }
}
```

### –ú–µ—Ç–æ–¥–∏ ThrottleService:

```javascript
// –ù–æ–≤—ñ –º–µ—Ç–æ–¥–∏
canMakeSearchQuery(userId)     // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—à—É–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
canMentionGryag(userId)        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–≥–∞–¥–æ–∫ –ì—Ä—è–≥–∞
getStats()                     // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
cleanup()                      // –û—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:

```javascript
// –î–æ–¥–∞–Ω–æ –≤ throttle.js
searchThrottling: {
  maxSearches: 3,           // 3 –ø–æ—à—É–∫–∏
  windowMs: 60 * 60 * 1000, // –∑–∞ –≥–æ–¥–∏–Ω—É
},
gryagMentionThrottling: {
  maxMentions: 3,           // 3 –∑–≥–∞–¥–∫–∏
  windowMs: 60 * 1000,      // –∑–∞ —Ö–≤–∏–ª–∏–Ω—É
}
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ç–µ—Å—Ç–∏:

1. **test-docker-integration.js**: –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ Docker —Å–∏—Å—Ç–µ–º–∏
2. **test-throttling-system.js**: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥ —Ñ—É–Ω–∫—Ü—ñ–π

### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:

```
üîç === –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥—É –ø–æ—à—É–∫—É (3/–≥–æ–¥–∏–Ω—É) ===
–ó–∞–ø–∏—Ç 1: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 2)
–ó–∞–ø–∏—Ç 2: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 1)
–ó–∞–ø–∏—Ç 3: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 0)
–ó–∞–ø–∏—Ç 4: ‚ùå –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ (—á–∞—Å –¥–æ —Å–∫–∏–¥–∞–Ω–Ω—è: 3600—Å)

ü§ñ === –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥—É –∑–≥–∞–¥–æ–∫ (3/—Ö–≤–∏–ª–∏–Ω—É) ===
–ó–≥–∞–¥–∫–∞ 1: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 2)
–ó–≥–∞–¥–∫–∞ 2: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 1)
–ó–≥–∞–¥–∫–∞ 3: ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ (–∑–∞–ª–∏—à–∏–ª–æ—Å—å: 0)
–ó–≥–∞–¥–∫–∞ 4: ‚ùå –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ (—á–∞—Å –¥–æ —Å–∫–∏–¥–∞–Ω–Ω—è: 60—Å)

üëë === –ê–¥–º—ñ–Ω–∏ ===
‚úÖ –ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
```

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥—É–≤–∞–Ω–Ω—è:
- –í—Å—ñ –¥—ñ—ó —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥—É –ª–æ–≥—É—é—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- –ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –ø—Ä–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—ñ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ `getStats()`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è:
- –°—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
- –ó–∞–ø–æ–±—ñ–≥–∞—î –≤–∏—Ç–æ–∫—É –ø–∞–º'—è—Ç—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É –æ—á–∏—â–µ–Ω–Ω—è

## üîí –ë–µ–∑–ø–µ–∫–∞

### Docker Security:
- Non-root –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É
- –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∞ –º–µ—Ä–µ–∂–∞
- –û–±–º–µ–∂–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏

### Throttling Security:
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Å–ø–∞–º—É –ø–æ—à—É–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
- –û–±–º–µ–∂–µ–Ω–Ω—è –∑–≥–∞–¥–æ–∫ –≤ –≥—Ä—É–ø–∞—Ö
- –ê–¥–º—ñ–Ω-–≤–∏–∫–ª—é—á–µ–Ω–Ω—è –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è
- –¢–∏—Ö–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (–±–µ–∑ —Å–ø–æ–≤—ñ—â–µ–Ω—å —Å–ø–∞–º–µ—Ä–∞–º)

## üöÄ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω:
```bash
# 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è
git clone <repo>
cd gryag-bot

# 2. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
cp .env.example .env
# –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ .env –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

# 3. –ó–∞–ø—É—Å–∫
./deploy.sh  # Linux/macOS
# –∞–±–æ
./deploy.ps1 # Windows
```

### –†–µ–∂–∏–º –†–æ–∑—Ä–æ–±–∫–∏:
```bash
docker-compose -f docker-compose.dev.yml up --build
```

## üìù –ü—ñ–¥—Å—É–º–æ–∫ –ó–º—ñ–Ω

### –§–∞–π–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ/–∑–º—ñ–Ω–µ–Ω—ñ:

1. **Docker Infrastructure**:
   - `Dockerfile`
   - `docker-compose.yml`
   - `docker-compose.dev.yml`
   - `scripts/auto-update.sh`
   - `scripts/healthcheck.js`
   - `deploy.sh` / `deploy.ps1`

2. **Throttling System**:
   - `src/bot/services/throttle.js` (—Ä–æ–∑—à–∏—Ä–µ–Ω–æ)
   - `src/bot/handlers/commands.js` (–æ–Ω–æ–≤–ª–µ–Ω–æ)
   - `src/bot/handlers/messages.js` (–æ–Ω–æ–≤–ª–µ–Ω–æ)

3. **Testing & Documentation**:
   - `test-docker-integration.js`
   - `test-throttling-system.js`
   - `DOCKER_IMPLEMENTATION.md`

### –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: –©–æ–Ω–æ—á—ñ –æ 3:00 AM
‚úÖ **–¢–∏—Ö–µ —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥**: –ë–µ–∑ —Å–ø–æ–≤—ñ—â–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
‚úÖ **–ê–¥–º—ñ–Ω –≤–∏–∫–ª—é—á–µ–Ω–Ω—è**: –ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤
‚úÖ **Cross-platform**: Linux, macOS, Windows –ø—ñ–¥—Ç—Ä–∏–º–∫–∞
‚úÖ **Production-ready**: Health checks, logging, monitoring
‚úÖ **Memory efficient**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è! üéâ
